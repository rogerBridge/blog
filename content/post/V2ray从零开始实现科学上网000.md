---
title: "V2rayä»é›¶å¼€å§‹å®ç°ç§‘å­¦ä¸Šç½‘--ç¬¬0æ­¥: é…ç½®VPS"
date: 2021-05-18T23:11:01+08:00
lastmod: 2021-05-18T23:11:01+08:00
draft: false
keywords: ["ç§‘å­¦ä¸Šç½‘", "ç¿»å¢™"]
description: "é…ç½®VPS"
tags: ["v2ray", "Linux"]
categories: ["GFW"]
author: "leo2n"

# You can also close(false) or open(true) something for this content.
# P.S. comment can only be closed
comment: true
toc: true
autoCollapseToc: false
postMetaInFooter: false
hiddenFromHomePage: false
# You can also define another contentCopyright. e.g. contentCopyright: "This is another copyright."
contentCopyright: true
---

<!--more-->

>ç”±äºå›½å†…ç½‘ç»œç¯å¢ƒçš„å½±å“, è·å–ä¸€äº›å›½å¤–æŠ€æœ¯èµ„è®¯, éœ€è¦ç§‘å­¦ä¸Šç½‘æŠ€æœ¯, åœ¨æ­¤è®°å½•ä¸€ä¸‹è‡ªå·±åœ¨è¿™æ–¹é¢çš„å­¦ä¹ å†ç¨‹å§

ç›®å‰, ä¸»æµçš„ç§‘å­¦ä¸Šç½‘æ–¹å¼æœ‰ä¸¤ç§, ä¸€ç§æ˜¯åŠ å¯†, ä¸€ç§æ˜¯ä¼ªè£…

åŠ å¯†çš„æ–¹å¼, ç¨å¾®æ¥è§¦è¿‡ä¸€ç‚¹ç§‘å­¦ä¸Šç½‘çš„äºº, åº”è¯¥éƒ½éå¸¸ç†Ÿæ‚‰, ä¾‹å¦‚: vmess on v2ray å°±æ˜¯ä¸€ç§åŠ å¯†æ–¹å¼, ä½†æ˜¯ç¼ºç‚¹æ˜¯æµé‡æ²¡æœ‰ç‰¹å¾, å®¹æ˜“è¢« GFW å°ç¦. ä¸ºä»€ä¹ˆå‘¢? å› ä¸ºæ²¡æœ‰ç‰¹å¾å…¶å®å°±æ˜¯æœ€å¤§çš„ç‰¹å¾, ä»€ä¹ˆäººä¼šç”¨å®Œå…¨æ²¡æœ‰ç‰¹å¾çš„æµé‡å‘¢? ä¸è¨€è‡ªæ˜~

è¿™ç³»åˆ—åšæ–‡, ä»‹ç»çš„ç§‘å­¦ä¸Šç½‘æ–¹æ¡ˆ, å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹: 

1. å¤–è¡¨æ˜¯äº’è”ç½‘ä¸Šéå¸¸å¸¸è§çš„åè®®, å†…éƒ¨å®ç°ä¸º: tls+websocket+vmess, å¤–éƒ¨ç‰¹å¾ä¸ºhttpsé•¿è¿æ¥
2. å¯ä»¥åœ¨æ­å»ºç¿»å¢™æ–¹æ¡ˆæ—¶, é¡ºä¾¿æä¸€ä¸ªåå‘ä»£ç†, è‡ªå·±å†™äº†å…¶ä»–æµ‹è¯•åº”ç”¨, ç›´æ¥ä¸¢åˆ°VPS, é€šè¿‡web serveræ¥è®¿é—®è‡ªå·±çš„æµ‹è¯•åº”ç”¨, å› ä¸ºweb server ä¸€èˆ¬éƒ½å¥—äº†ä¸€å±‚tls, çœå¾—ä¸ºä¸åŒåº”ç”¨æå®‰å…¨æ–¹æ¡ˆäº†
3. ä½¿ç”¨dockeréƒ¨ç½², æœªæ¥å¯èƒ½ä¼šæ”¹ä¸ºdocker compose, æ–¹ä¾¿åœ¨ä¸åŒæœºå™¨ä¸Šè¿›è¡Œéƒ¨ç½²
4. (å¯é€‰) å¦‚æœä½ ä¸ä¿¡ä»»è‡ªå·±çš„VPSæä¾›å•†, æ‹…å¿ƒä¼šè¢«è®°å½•è®¿é—®ç«™ç‚¹, å¯ä»¥ç”¨ç¬¬ä¸€å±‚VPSåšè·³æ¿, è·³è½¬åˆ°ç¬¬äºŒå±‚VPS

æœ€å¥½çš„æ–¹å¼å…¶å®æ˜¯å°†è‡ªå·±è—åŒ¿äºäººç¾¤ä¸­, ä½ å¯ä»¥ä½¿ç”¨æ˜é¢ä¸Šçš„ https æµé‡, åŸŸåæŒ‡å‘ä½ çš„ç½‘ç«™, ä½†æ˜¯, æ¥æ”¶åˆ°ä½ çš„è¯·æ±‚çš„ web æœåŠ¡å™¨ä¼šä»ä½ çš„è¯·æ±‚ URL ä¸­åˆ¤æ–­(URL æ˜¯ä¸ä¼šè¢« GFW æŸ¥çœ‹åˆ°çš„, ä¾‹å¦‚: ä½ çš„ç½‘ç«™æ˜¯: mydomain.com, è¯·æ±‚ URL æ˜¯: /say, é‚£ä¹ˆè¿™ä¸ª/say æ˜¯ä¸ä¼šè¢« GFW æŸ¥çœ‹åˆ°çš„, å¯ä»¥çŸ¥æ™“çš„ä»…ä»…æ˜¯: mydomain.com, ä¸ºä»€ä¹ˆå‘¢? å› ä¸º client åœ¨å»ºç«‹ TLS è¿æ¥çš„æ—¶å€™, ä»…ä»…æš´éœ²äº†ç›®æ ‡åŸŸå, å¦‚æœè¿ç›®æ ‡åŸŸåéƒ½ä¸æƒ³æš´éœ²çš„è¯, å°±å¾—ä½¿ç”¨  [ESNI](https://www.cloudflare.com/learning/ssl/what-is-encrypted-sni/) , å¯æƒœ, å›½å†…ç›®å‰ä¸æ”¯æŒESNI), ä½ åˆ°åº•æ˜¯æƒ³è¦æŸ¥çœ‹è‡ªå·±çš„ç½‘ç«™, è¿˜æ˜¯æƒ³è®¿é—®ç‰¹å®šçš„ web app, web server ä¼šæ ¹æ®ä½ çš„ URL æ¥åˆ¤æ–­, æœ‰ç–‘æƒ‘çš„è¯, éšä¾¿æŠ“ä¸€ä¸ªhttpsç½‘ç«™çš„åŒ…éªŒè¯ä¸€ä¸‹ğŸ˜‚)

æµç¨‹å›¾å¦‚ä¸‹:

![](/img/V2rayç§‘å­¦ä¸Šç½‘æ–¹æ¡ˆ/proxy.png)

è¿‡ç¨‹å¦‚ä¸‹:

æœ¬åœ°è®¾å¤‡ä¸ Web æœåŠ¡å™¨å»ºç«‹ TLS è¿æ¥, Web æœåŠ¡å™¨é€šè¿‡æŸ¥çœ‹è®¾å¤‡çš„ URL, å°†è¯·æ±‚è½¬å‘è‡³ä¸åŒçš„ App, Appå…·ä½“åšä»€ä¹ˆç”±ä½ æ§åˆ¶, æ¯”å¦‚è¯´: ä½ å¯ä»¥è®¾ç½®: `/free`è¿™ä¸ªURLä½œä¸ºç¿»å¢™åº”ç”¨, `/blog`è¿™ä¸ªURLä½œä¸ºä½ çš„åšå®¢åº”ç”¨, `/msg`è¿™ä¸ªURLä½œä¸ºä½ çš„æ¶ˆæ¯é€šçŸ¥æœºå™¨äººåº”ç”¨(ä¾‹å¦‚: telegram ä¸­çš„ä¸€äº›APIç»„åˆèµ·æ¥åšæ¶ˆæ¯æœºå™¨äºº), `/` è¿™ä¸ªURLä½œä¸ºä½ çš„ä¸»ç«™ç‚¹åº”ç”¨.

## æŒ‘é€‰VPS

é¦–å…ˆ, ä½ éœ€è¦æŒ‘é€‰ä¸€ä¸ªå¥½ç”¨çš„VPS, å¦‚ä½•åˆ¤æ–­VPSæ˜¯å¦å¥½ç”¨å‘¢? 

ä¸»è¦ç”¨ä»¥ä¸‹å‡ ä¸ªå·¥å…·åˆ¤æ–­: 

1. tcping
2. traceroute
3. mtr
4. scp

### tcping

> tcpingæ˜¯ä¸€æ¬¾ç±»ä¼¼pingçš„å·¥å…·, ä¸åŒçš„æ˜¯: pingæµ‹è¯•çš„æ˜¯ICMPåè®®, è€Œtcpingæµ‹è¯•çš„æ˜¯TCPåè®®

ä»£ç åœ°å€: [tcping](https://github.com/cloverstd/tcping) , å¯ä»¥åˆ¤æ–­å»¶è¿Ÿ &&  ç‰¹å®šç«¯å£æ˜¯å¦è¢«å°

### traceroute

> tracerouteå¯ä»¥æŸ¥çœ‹æ•°æ®åŒ…ç”±æœ¬åœ°è®¾å¤‡å‘å¾€ç›®çš„è®¾å¤‡çš„è¿‡ç¨‹ä¸­, ç»è¿‡çš„ç½‘å…³èŠ‚ç‚¹çš„å»¶æ—¶

### mtr

> mtræ˜¯ä¸€æ¬¾å¯ä»¥æŸ¥çœ‹æ•°æ®åŒ…åœ¨ç”±æœ¬åœ°è®¾å¤‡å‘å¾€ç›®çš„è®¾å¤‡çš„è¿‡ç¨‹ä¸­, æŸ¥çœ‹ä¸¢åŒ…ç‡ç­‰æ•°æ®

### scp

> scp æ˜¯é€šè¿‡sshåè®®ä¼ è¾“æ–‡ä»¶çš„å·¥å…·, ä½¿ç”¨ä»–, ä½ å¯ä»¥æµ‹è¯•ä»VPSä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°çš„é€Ÿåº¦, å½“ç„¶, å¦‚æœä½ æ˜¯å…¬ç½‘IP, ä¹Ÿå¯ä»¥æµ‹è¯•ä»æœ¬åœ°è®¾å¤‡ä¸Šä¼ æ–‡ä»¶åˆ°VPSçš„é€Ÿåº¦, ä¸è¿‡ç°å¦‚ä»Šå…¬ç½‘IPä¸å¤šäº†å§, æ‰€ä»¥... ä¸Šä¼ æµ‹è¯•çš„è¯, è¿˜æ˜¯ç”¨[speedtest](https://www.speedtest.net/)å§(æ³¨æ„é€šè¿‡ä»£ç†è®¿é—®)

## éƒ¨ç½²VPS

ç„¶å, å°±å¯ä»¥å¼€å§‹éƒ¨ç½²VPSå•¦

æ–°çš„VPSåˆ°æ‰‹, æ¿€åŠ¨çš„å¿ƒæƒ…è¿‡å, éœ€è¦åšçš„äº‹æƒ…, è¿˜æ˜¯ä¸å°‘æ»´, å‚è€ƒdigitaloceançš„è¿™ç¯‡æ–‡ç« : [Initial server setup](https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04)

### æ·»åŠ æ–°ç”¨æˆ·

ç»å¤§å¤šæ•°æƒ…å†µä¸‹, ä¸å»ºè®®ç›´æ¥ä½¿ç”¨rootç”¨æˆ·æ¥æ“ä½œ, è€Œæ˜¯ä½¿ç”¨å¤„åœ¨sudoç”¨æˆ·ç»„ä¸­çš„ç”¨æˆ·æ¥æ“ä½œ

```bash
# é¦–å…ˆ, åˆ‡æ¢åˆ°root user
# ä¹‹åå°±ä¼šå¼€å§‹æé†’ä½ , è¾“å…¥æ–°å¯†ç å•¦
sudo passwd root
# åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·, usernameè®¾ç½®ä¸€ä¸ªä½ æƒ³è¦è®¾ç½®çš„, for instance, `adduser clack`
adduser clark
# ä¸­è‹±æ–‡åˆ‡æ¢å¥½éº»çƒ¦, ç”¨è‹±æ–‡å•¦
# Add your new user to sudo user group
usermod -aG sudo clark
```

### ä½¿ç”¨SSH pubkeyè¿æ¥æœåŠ¡å™¨

```bash
# ç”Ÿæˆä½ çš„SSH key pair, å¯†é’¥åœ¨æœ¬åœ°è®¾å¤‡, å…¬é’¥å¤åˆ¶åˆ°VPSçš„~/.ssh/authorized_keys æ–‡ä»¶ä¸­, åšæ–‡ä¸­æœ‰ä¸€ç¯‡: "sshç™»å½•è¿œç¨‹æœºå™¨ä¸”ä¸ç”¨å¯†ç " æåˆ°è¿™ä¸ª
# ç”Ÿæˆç»“æŸå, æœ¬åœ°è®¾å¤‡é€šè¿‡SSHè¿æ¥VPS, å¦‚æœæˆåŠŸ, å¼€å§‹
# set /etc/ssh/sshd_config
nano /etc/ssh/sshd_config
# change below:
# Protocol 2    
# Port 22   ç«¯å£ä¸€èˆ¬æƒ…å†µä¸‹ä¸è¦æ”¹
# MaxAuthTries 3  å°è¯•å¤±è´¥æ¬¡æ•°æœ€å¤§é™åˆ¶ä¸º3æ¬¡
# PermitRootLogin no ä¸å…è®¸rootç”¨æˆ·ç™»å½•
# PubkeyAuthentication yes å…è®¸pubkeyæ–¹å¼ç™»å½•
# PasswordAuthentication no ä¸å…è®¸å¯†ç ç™»å½•
sudo systemctl restart sshd.service # é‡å¯sshdæœåŠ¡
```

### è®¾ç½®UFW rules

```bash
# setting up a basic firewall
# show apps that ufw allowed
sudo ufw app list
# default deny incoming data
sudo ufw default deny incoming
# default allow outgoing data 
sudo ufw default allow outgoing
# add what you want app that can pass the Firewall
sudo ufw allow 22
sudo ufw allow 443
sudo ufw allow $what_you_want_port # è¿™é‡Œä¸€èˆ¬ä¸ç”¨å¡«, å› ä¸ºæˆ‘ä»¬å¯èƒ½éƒ½è¦èµ°443ç«¯å£äº†, é™¤éä½ æœ‰åº”ç”¨è¦ç›´æ¥å’Œå¤–ç½‘è¿æ¥
```

## å®‰è£…Dockerç¯å¢ƒ

å®˜æ–¹çš„Dockerå®‰è£…æ•™ç¨‹åœ¨æ­¤: [Install Docker](https://docs.docker.com/engine/install/ubuntu/), ä»¥Ubuntuç¯å¢ƒä¸ºä¾‹:

```bash
# å¸è½½æ—§ç‰ˆæœ¬Docker
sudo apt-get remove docker docker-engine docker.io containerd runc
# æ·»åŠ  Repository
sudo apt update;
sudo apt install apt-transport-https ca-certificates curl gpg lsb-release
# æ·»åŠ å®˜æ–¹gpg key
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
# æ·»åŠ å®˜æ–¹æº
echo \
  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
# å®‰è£…Docker
sudo apt-get update;
sudo apt-get install docker-ce docker-ce-cli containerd.io;
# å°†å½“å‰ç”¨æˆ·æ·»åŠ è¿›å…¥dockerç”¨æˆ·ç»„, è®©non-rootç”¨æˆ·å¯ä»¥æ‰§è¡Œdockerå‘½ä»¤
sudo usermod -aG docker $USER
# ç„¶åæ‰§è¡Œlog out and log in || newgrp docker
# ä¸ºäº†æ£€éªŒnon-rootç”¨æˆ·æ˜¯å¦å¯ä»¥ç›´æ¥æ‰§è¡Œdockerå‘½ä»¤, æ‰§è¡Œä¸‹åˆ—å‘½ä»¤, æˆåŠŸäº†ä¼šæœ‰æç¤º
docker run hello-world
```



## æ€»ç»“

é˜²ç«å¢™è§„åˆ™çš„æ·»åŠ å’Œsshd_configçš„ä¿®æ”¹ä¸»è¦æ˜¯ä¸ºäº†VPSçš„å®‰å…¨æ€§ç€æƒ³, ä½ å®åœ¨æ˜¯æ— æ³•æƒ³è±¡æœåŠ¡å™¨æ¯å¤©è¦è¢«æ¢æµ‹å¤šå°‘æ¬¡ğŸ¤£(çœ‹ä¸€çœ¼sshd.serviceçš„statuså’Œlogä¼šè®©ä½ æœ‰æ‰€æ„Ÿè§¦), è¿™åªæ˜¯æœ€åŸºæœ¬çš„é˜²æŠ¤æ‰‹æ®µ, è¿˜æœ‰ä¸€äº›ç›‘æµ‹ç³»åˆ—, ä»¥åå†å‘å§.

